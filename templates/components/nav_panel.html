{% macro render(data, active_slug, classes=[]) %}
{# SAFETY FIX: Find matches first, then default to index 0 if specific slug not found #}
{% set matches = data | selectattr('slug', 'equalto', active_slug) | list %}
{% set active_item = matches[0] if matches else data[0] %}

<article class="panel nav-panel {{ classes|join(' ') }}">
    <header>
        <h1>{{ active_item.title }}</h1>
        
        <nav aria-label="Section Navigation">
            <ul>
                {% for item in data %}
                <li>
                    <a href="?tab={{ item.slug }}" 
                       class="{{ 'current' if item.slug == active_item.slug else '' }}"
                       {% if item.slug == active_item.slug %}aria-current="page"{% endif %}>
                        {{ item.label }}
                    </a>
                </li>
                {% endfor %}
            </ul>
        </nav>
    </header>

    <section class="content">
        {% if caller %}
            {{ caller() }}
        {% else %}
            {{ active_item.content }}
        {% endif %}
    </section>

    </article>
{% endmacro %}